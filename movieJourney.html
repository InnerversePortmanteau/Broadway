<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Our Movie Quest: A Collaborative Framework</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; background: black; color: #e2e8f0; min-height: 100vh; margin: 0; overflow-x: hidden; }
  canvas#starfield { position: fixed; top:0; left:0; z-index:-1; }
  .glass-card { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(148,163,184,0.1); }
  .quadrant { transition: all 0.6s ease; border-radius:1.5rem; margin-bottom:1rem; cursor: pointer; }
  .quadrant.expanded { position: relative; transform: scale(1.05); border-top: 8px solid transparent; border-bottom: 8px transparent; animation: reelAppear 0.8s forwards; z-index:10; }
  @keyframes reelAppear { 0% { border-image: none; border-top-color: transparent; border-bottom-color: transparent; } 50%,100% { border-image: repeating-linear-gradient(to right,#94a3b8 0 10px,transparent 10px 20px) 20 round; border-top-color:#94a3b8; border-bottom-color:#94a3b8; border-image-slice:100; } }
  .quadrant.expanded::after { content:""; position:absolute; top:0; left:-100%; width:200%; height:100%; background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,0.1) 50%,transparent 100%); animation: reelShimmer 2s infinite; pointer-events:none; border-radius:inherit; }
  @keyframes reelShimmer { from { left:-100%; } to { left:100%; } }
  .expand-btn { transition: all 0.3s ease; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:50%; background: rgb(51,65,85); border:none; color:white; font-weight:bold; font-size:1.125rem; cursor:pointer; }
  .expand-btn:hover { background: rgb(71,85,105); transform:scale(1.1); }
  .expand-btn.rotated { transform: rotate(45deg) scale(1.1); }
  .crisis-btn { background: #b91c1c; color: white; padding:0.5rem 1rem; border-radius:0.5rem; transition: background 0.3s; }
  .crisis-btn:hover { background: #dc2626; }
  .fade-in { animation: fadeIn 0.5s ease-in; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity:1; } }
  .movie-card img { width: 100%; max-height: 256px; object-fit: cover; border-radius:0.75rem; margin-top:0.5rem; }
  .btn-primary { width:100%; padding:0.5rem 1rem; margin-top:0.5rem; font-weight:600; color:white; background:linear-gradient(135deg, rgb(59,130,246) 0%, rgb(99,102,241) 100%); border:none; border-radius:0.5rem; box-shadow:0 4px 14px 0 rgba(59,130,246,0.3); transition: all 0.3s ease; cursor:pointer; }
  .btn-primary:hover:not(:disabled) { background:linear-gradient(135deg, rgb(37,99,235) 0%, rgb(79,70,229) 100%); transform:translateY(-1px); box-shadow:0 10px 25px rgba(59,130,246,0.4); }
  .btn-primary:disabled { cursor:not-allowed; opacity: 0.5; }
  .rewards-badge { display:inline-block; padding:0.25rem 0.75rem; border-radius:9999px; font-size:0.875rem; font-weight:bold; }
  .rewards-earned { background: rgba(34,197,94,0.2); color: rgb(34,197,94); border:1px solid rgba(34,197,94,0.3); animation: pulseGlow 2s infinite; }
  @keyframes pulseGlow { 0%,100%{box-shadow:0 0 5px rgba(34,197,94,0.5);}50%{box-shadow:0 0 20px rgba(34,197,94,0.8);} }
  .back-btn { background: rgb(51,65,85); color:white; padding:0.5rem 1rem; border-radius:0.5rem; transition: background 0.3s; margin-top:1rem; }
  .back-btn:hover { background: rgb(71,85,105); }
  .screen { display: none; }
  .quiz-container { display: none; }
  .quiz-button { background: #10b981; color: white; font-weight: 600; }
  .quiz-button:hover { background: #059669; }
  .quadrant-completed::after {
    content: "‚úì"; position: absolute; top: 1rem; right: 1rem;
    background: #10b981; color: white; border-radius: 50%;
    width: 2rem; height: 2rem; display: flex; align-items: center;
    justify-content: center; font-weight: bold; font-size: 1.25rem;
  }
  .processing { pointer-events: none; opacity: 0.7; }
</style>
</head>
<body class="p-4 sm:p-8">
<canvas id="starfield"></canvas>

<div class="container mx-auto">
  <!-- Header -->
  <header class="text-center py-8">
    <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 mb-4">Our Movie Quest</h1>
    <p class="mt-4 text-xl text-slate-400">A collaborative framework for our shared journey to cinema victory.</p>
  </header>

  <!-- Audio Player -->
  <div class="glass-card rounded-2xl p-6 mb-8 text-center">
    <h3 class="text-2xl font-bold text-white mb-4 flex items-center justify-center gap-2"><span class="text-2xl" aria-hidden="true">üéµ</span> Our Movie Quest Theme Song</h3>
    <audio id="movie-theme-song" controls class="w-full rounded-lg"></audio>
  </div>

  <!-- Main Grid Container - This is the primary choice screen -->
  <div id="main-screen" class="grid grid-cols-1 lg:grid-cols-2 gap-8 screen fade-in">
    <!-- Quadrant 1: Known Knowns -->
    <div class="quadrant known-knowns glass-card p-6 shadow-xl border border-slate-700" onclick="window.showScreen('known-knowns-screen')" role="button" tabindex="0" aria-label="Known Knowns: The AMC Stubs Goal. Click to learn more.">
      <div class="quadrant-header flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üé¨</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Known Knowns</h2>
            <p id="known-knowns-progress" class="text-sm text-slate-400">The AMC Stubs Goal</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quadrant 2: Known Unknowns -->
    <div class="quadrant known-unknowns glass-card p-6 shadow-xl border border-slate-700" onclick="window.showScreen('known-unknowns-screen')" role="button" tabindex="0" aria-label="Known Unknowns: The Planning & Research. Click to start the quiz.">
      <div class="quadrant-header flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üìù</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Known Unknowns</h2>
            <p id="known-unknowns-progress" class="text-sm text-slate-400">The Planning & Research</p>
          </div>
        </div>
      </div>
      <p class="mt-4 text-slate-400 hidden">This section is a placeholder for future adventures. Stay tuned!</p>
    </div>

    <!-- Quadrant 3: Unknown Knowns -->
    <div class="quadrant unknown-knowns glass-card p-6 shadow-xl border border-slate-700" onclick="window.showScreen('unknown-knowns-screen')" role="button" tabindex="0" aria-label="Unknown Knowns: Our Shared Relational World. Click to take the loyalty quiz.">
      <div class="quadrant-header flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">ü§ù</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Unknown Knowns</h2>
            <p id="unknown-knowns-progress" class="text-sm text-slate-400">Our Shared Relational World</p>
          </div>
        </div>
      </div>
      <p class="mt-4 text-slate-400 hidden">This section is a placeholder for future adventures. Stay tuned!</p>
    </div>

    <!-- Quadrant 4: Unknown Unknowns -->
    <div class="quadrant unknown-unknowns glass-card p-6 shadow-xl border border-slate-700" onclick="window.showScreen('unknown-unknowns-screen')" role="button" tabindex="0" aria-label="Unknown Unknowns: Navigating the Unpredictable. Click to run the simulation.">
      <div class="quadrant-header flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üé≤</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Unknown Unknowns</h2>
            <p id="unknown-unknowns-progress" class="text-sm text-slate-400">Navigating the Unpredictable</p>
          </div>
        </div>
      </div>
      <p class="mt-4 text-slate-400 hidden">This section is a placeholder for future adventures. Stay tuned!</p>
    </div>
  </div>

  <!-- Known Knowns Screen -->
  <div id="known-knowns-screen" class="screen">
    <div class="glass-card p-6 rounded-2xl shadow-xl border border-slate-700">
      <button class="back-btn" onclick="window.showScreen('main-screen')">‚Üê Back</button>
      <div class="quadrant-header mt-4 flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üé¨</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Known Knowns</h2>
            <p class="text-sm text-slate-400">The AMC Stubs Goal</p>
          </div>
        </div>
      </div>
      <p class="mt-4 mb-4 text-slate-300">This is our foundation. We know the rules and the rewards. Our goal is clear: to watch the movies and unlock the perks.</p>
      <div class="glass-card p-4 rounded-xl mb-6">
        <div class="flex items-center justify-between mb-2">
          <span class="font-semibold text-sm">Movies Watched: <span id="movies-watched" class="font-bold text-white">0</span>/5</span>
          <span id="rewards-status" class="text-sm font-bold"></span>
        </div>
        <div class="progress-bar mt-2 bg-slate-700 rounded-full overflow-hidden">
          <div id="progress-fill" class="progress-fill h-4 bg-gradient-to-r from-teal-400 to-green-500 transition-all"></div>
        </div>
      </div>
      <div class="mt-6 space-y-4">
        <!-- Movies with Trivia -->
        <div class="movie-card text-center" data-movie="Downton Abbey: The Grand Finale">
          <div class="h-10 flex items-center justify-center">
            <h3 class="text-white font-bold">Downton Abbey: The Grand Finale</h3>
          </div>
          <img class="w-full max-h-48 object-cover shadow-lg" src="Downton_Abbey_The_Grand_Finale.jpg" alt="Downton Abbey: The Grand Finale movie poster" onerror="this.src='https://placehold.co/256x384/2c2c2c/e2e8f0?text=Image+Not+Found'">
          <div class="flex justify-center space-x-4 mt-2">
            <a href="https://www.imdb.com/find?q=Downton+Abbey:+The+Grand+Finale" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">IMDb</a>
            <a href="https://www.rottentomatoes.com/search?q=Downton+Abbey:+The+Grand+Finale" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">üçÖ Rotten Tomatoes</a>
          </div>
          <button class="btn-primary" onclick="window.showQuiz(this,event)">Start Trivia!</button>
          <div class="quiz-container space-y-2 mt-4 hidden" role="region" aria-live="polite">
            <h4 class="text-lg font-bold text-white">Movie Trivia</h4>
            <div class="quiz-question text-slate-300"></div>
            <div class="quiz-options flex flex-col space-y-2" role="group"></div>
            <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
            <button class="mark-watched-btn btn-primary hidden" onclick="window.markAsWatched(this,event)">Mark as Watched</button>
          </div>
        </div>
        <div class="movie-card text-center" data-movie="Anemone">
          <div class="h-10 flex items-center justify-center">
            <h3 class="text-white font-bold">Anemone</h3>
          </div>
          <img class="w-full max-h-48 object-cover shadow-lg" src="Anemone.jpg" alt="Anemone movie poster" onerror="this.src='https://placehold.co/256x384/2c2c2c/e2e8f0?text=Image+Not+Found'">
          <div class="flex justify-center space-x-4 mt-2">
            <a href="https://www.imdb.com/find?q=Anemone" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">IMDb</a>
            <a href="https://www.rottentomatoes.com/search?q=Anemone" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">üçÖ Rotten Tomatoes</a>
          </div>
          <button class="btn-primary" onclick="window.showQuiz(this,event)">Start Trivia!</button>
          <div class="quiz-container space-y-2 mt-4 hidden" role="region" aria-live="polite">
            <h4 class="text-lg font-bold text-white">Movie Trivia</h4>
            <div class="quiz-question text-slate-300"></div>
            <div class="quiz-options flex flex-col space-y-2" role="group"></div>
            <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
            <button class="mark-watched-btn btn-primary hidden" onclick="window.markAsWatched(this,event)">Mark as Watched</button>
          </div>
        </div>
        <div class="movie-card text-center" data-movie="Bugonia">
          <div class="h-10 flex items-center justify-center">
            <h3 class="text-white font-bold">Bugonia</h3>
          </div>
          <img class="w-full max-h-48 object-cover shadow-lg" src="Bugonia.jpg" alt="Bugonia movie poster" onerror="this.src='https://placehold.co/256x384/2c2c2c/e2e8f0?text=Image+Not+Found'">
          <div class="flex justify-center space-x-4 mt-2">
            <a href="https://www.imdb.com/find?q=Bugonia" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">IMDb</a>
            <a href="https://www.rottentomatoes.com/search?q=Bugonia" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">üçÖ Rotten Tomatoes</a>
          </div>
          <button class="btn-primary" onclick="window.showQuiz(this,event)">Start Trivia!</button>
          <div class="quiz-container space-y-2 mt-4 hidden" role="region" aria-live="polite">
            <h4 class="text-lg font-bold text-white">Movie Trivia</h4>
            <div class="quiz-question text-slate-300"></div>
            <div class="quiz-options flex flex-col space-y-2" role="group"></div>
            <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
            <button class="mark-watched-btn btn-primary hidden" onclick="window.markAsWatched(this,event)">Mark as Watched</button>
          </div>
        </div>
        <div class="movie-card text-center" data-movie="Hamnet">
          <div class="h-10 flex items-center justify-center">
            <h3 class="text-white font-bold">Hamnet</h3>
          </div>
          <img class="w-full max-h-48 object-cover shadow-lg" src="Hamnet.jpg" alt="Hamnet movie poster" onerror="this.src='https://placehold.co/256x384/2c2c2c/e2e8f0?text=Image+Not+Found'">
          <div class="flex justify-center space-x-4 mt-2">
            <a href="https://www.imdb.com/find?q=Hamnet" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">IMDb</a>
            <a href="https://www.rottentomatoes.com/search?q=Hamnet" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">üçÖ Rotten Tomatoes</a>
          </div>
          <button class="btn-primary" onclick="window.showQuiz(this,event)">Start Trivia!</button>
          <div class="quiz-container space-y-2 mt-4 hidden" role="region" aria-live="polite">
            <h4 class="text-lg font-bold text-white">Movie Trivia</h4>
            <div class="quiz-question text-slate-300"></div>
            <div class="quiz-options flex flex-col space-y-2" role="group"></div>
            <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
            <button class="mark-watched-btn btn-primary hidden" onclick="window.markAsWatched(this,event)">Mark as Watched</button>
          </div>
        </div>
        <div class="movie-card text-center" data-movie="Song Sung Blue">
          <div class="h-10 flex items-center justify-center">
            <h3 class="text-white font-bold">Song Sung Blue</h3>
          </div>
          <img class="w-full max-h-48 object-cover shadow-lg" src="Song_Sung_Blue.jpg" alt="Song Sung Blue movie poster" onerror="this.src='https://placehold.co/256x384/2c2c2c/e2e8f0?text=Image+Not+Found'">
          <div class="flex justify-center space-x-4 mt-2">
            <a href="https://www.imdb.com/find?q=Song+Sung+Blue" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">IMDb</a>
            <a href="https://www.rottentomatoes.com/search?q=Song+Sung+Blue" target="_blank" rel="noopener" class="text-sm text-slate-400 hover:text-white">üçÖ Rotten Tomatoes</a>
          </div>
          <button class="btn-primary" onclick="window.showQuiz(this,event)">Start Trivia!</button>
          <div class="quiz-container space-y-2 mt-4 hidden" role="region" aria-live="polite">
            <h4 class="text-lg font-bold text-white">Movie Trivia</h4>
            <div class="quiz-question text-slate-300"></div>
            <div class="quiz-options flex flex-col space-y-2" role="group"></div>
            <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
            <button class="mark-watched-btn btn-primary hidden" onclick="window.markAsWatched(this,event)">Mark as Watched</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Known Unknowns Screen -->
  <div id="known-unknowns-screen" class="screen">
    <div class="glass-card p-6 rounded-2xl shadow-xl border border-slate-700">
      <button class="back-btn" onclick="window.showScreen('main-screen')">‚Üê Back</button>
      <div class="quadrant-header mt-4 flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üìù</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Known Unknowns</h2>
            <p class="text-sm text-slate-400">The Planning & Research</p>
          </div>
        </div>
      </div>
      <p class="mt-4 mb-4 text-slate-300">Let's solve our shared unknowns with a little introspection!</p>
      <div class="mt-6 space-y-4" id="known-unknowns-quiz-container">
        <!-- Quiz will be dynamically inserted here -->
        <button class="btn-primary" onclick="window.startKnownUnknownsQuiz()">Start the Planning & Research Quiz</button>
      </div>
    </div>
  </div>

  <!-- Unknown Knowns Screen -->
  <div id="unknown-knowns-screen" class="screen">
    <div class="glass-card p-6 rounded-2xl shadow-xl border border-slate-700">
      <button class="back-btn" onclick="window.showScreen('main-screen')">‚Üê Back</button>
      <div class="quadrant-header mt-4 flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">ü§ù</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Unknown Knowns</h2>
            <p class="text-sm text-slate-400">Our Shared Relational World</p>
          </div>
        </div>
      </div>
      <p class="mt-4 mb-4 text-slate-300">Drawing from the wisdom of "The Untouchables," this is about finding power and safety not in individual strength, but in our shared loyalty and trust. Our combined tastes, hunches, and preferences are our hidden wisdom.</p>
      <div class="glass-card p-4 rounded-xl text-center">
        <h4 class="font-semibold text-slate-300 mb-2">Our "Relational Holding Environment" Quiz</h4>
        <p class="text-sm text-slate-400 mb-4">Are you ready to commit to the team?</p>
        <button id="relational-quiz-button" class="btn-primary" onclick="window.startRelationalQuiz()">Prove Your Loyalty</button>
        <div class="quiz-container space-y-2 mt-4 hidden" id="relational-quiz-container" role="region" aria-live="polite">
          <div class="quiz-question text-slate-300"></div>
          <div class="quiz-options flex flex-col space-y-2" role="group"></div>
          <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Unknown Unknowns Screen -->
  <div id="unknown-unknowns-screen" class="screen">
    <div class="glass-card p-6 rounded-2xl shadow-xl border border-slate-700">
      <button class="back-btn" onclick="window.showScreen('main-screen')">‚Üê Back</button>
      <div class="quadrant-header mt-4 flex justify-between items-center">
        <div class="quadrant-title-group flex items-center space-x-3">
          <span class="quadrant-icon text-2xl" aria-hidden="true">üé≤</span>
          <div>
            <h2 class="text-2xl font-bold text-white">Unknown Unknowns</h2>
            <p class="text-sm text-slate-400">Navigating the Unpredictable</p>
          </div>
        </div>
      </div>
      <p class="mt-4 mb-4 text-slate-300">These are the unpredictable "black swan" events that could derail our plans. Our resilience is key here.</p>
      <div class="glass-card p-4 rounded-xl text-center">
        <h4 class="font-semibold text-slate-300 mb-4">Social Entropy Simulator</h4>
        <p class="text-sm text-slate-400 mb-4">Click to simulate an unexpected event and see our shared resilience in action.</p>
        <button id="start-crisis-button" class="crisis-btn" onclick="window.startCrisisSimulation()">Begin Simulation</button>
        <div id="crisis-container" class="mt-4 p-3 rounded-lg text-sm hidden fade-in" role="region" aria-live="polite">
          <div id="crisis-event" class="font-semibold text-red-300 mb-2"></div>
          <div id="crisis-solution" class="mt-4 pt-3 border-t border-green-800/30">
            <div class="font-semibold text-green-300 mb-2">Relational Solution:</div>
            <div id="crisis-solution-text" class="text-green-200 text-left" aria-live="assertive"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const audioUrl = 'https://cdn.jsdelivr.net/gh/InnerversePortmanteau/Broadway/our-movie-quest.mp3';
let movieData = {};
let sectionProgress = { knownKnowns: false, knownUnknowns: false, unknownKnowns: false, unknownUnknowns: false };

function loadData() {
  try {
    movieData = JSON.parse(localStorage.getItem('movieData')) || {};
    sectionProgress = JSON.parse(localStorage.getItem('sectionProgress')) || sectionProgress;
  } catch (e) {
    console.warn('localStorage not available, using memory storage');
    movieData = {};
  }
}

function saveData() {
  try {
    localStorage.setItem('movieData', JSON.stringify(movieData));
    localStorage.setItem('sectionProgress', JSON.stringify(sectionProgress));
  } catch (e) {
    console.warn('Cannot save to localStorage');
  }
}

const totalMovies = 5;
const progressFill = document.getElementById('progress-fill');
const moviesWatchedSpan = document.getElementById('movies-watched');
const rewardsStatus = document.getElementById('rewards-status');
const movieCards = document.querySelectorAll('.movie-card');

const movieQuizzes = {
  "Downton Abbey: The Grand Finale": {
    question: "What family is at the center of the Downton Abbey series?",
    answers: ["The Windsors", "The Crawleys", "The Bluths", "The Lannisters"],
    correctAnswer: 1
  },
  "Anemone": {
    question: "Anemone are often associated with which marine animal?",
    answers: ["Dolphins", "Sharks", "Clownfish", "Whales"],
    correctAnswer: 2
  },
  "Bugonia": {
    question: "What does the ancient Greek word 'Bugonia' refer to?",
    answers: ["The study of insects", "The mythical origin of bees from a bull's carcass", "A rare flower", "A type of ancient pottery"],
    correctAnswer: 1
  },
  "Hamnet": {
    question: "Who was Hamnet?",
    answers: ["Shakespeare's twin son", "A famous playwright", "A character from Hamlet", "The name of a popular tavern"],
    correctAnswer: 0
  },
  "Song Sung Blue": {
    question: "What famous singer had a hit song called 'Song Sung Blue'?",
    answers: ["Elton John", "Frank Sinatra", "Neil Diamond", "Johnny Cash"],
    correctAnswer: 2
  }
};

const knownUnknownsQuizzes = {
  "q1": {
    question: "Which movie are we most excited to see first?",
    answers: ["The one with the least-sticky floors.", "The one with the pre-approved snack order.", "The one that solves the greatest mystery: who ate the last of the popcorn?", "The one that doesn't require a 3-hour pre-screening discussion."],
    correctAnswer: 2
  },
  "q2": {
    question: "What if we weren't spending so much time on showtimes and could just focus on popcorn?",
    answers: ["Our lives would be filled with more butter.", "The kernel-to-pop ratio would finally be optimized.", "We'd become popcorn-centric beings and achieve snack-based enlightenment.", "The movie industry would implode from our sheer focus."],
    correctAnswer: 2
  },
  "q3": {
    question: "What's the real cost of our time spent on this decision?",
    answers: ["Approximately 3.7 jumbo sodas.", "The emotional debt of indecision.", "The missed opportunity to be napping instead.", "An invaluable, shared experience that can't be measured in monetary terms... unless you count the gas money."],
    correctAnswer: 3
  },
  "q4": {
    question: "Are we confident that we're in full control of our movie nights, and not just dependent on a third party's business model?",
    answers: ["Yes, we have a secret movie-picking algorithm. It's called 'eenie-meenie-miny-moe.'", "No, we are but cogs in the cinematic machine.", "Our control is as solid as a bowl of buttery popcorn.", "The only thing we control is the strategic placement of our nachos."],
    correctAnswer: 0
  },
  "q5": {
    question: "How would it feel to have a data-backed case for our movie night, so we can stop guessing?",
    answers: ["It would feel like winning a trivia contest we didn't study for.", "It would feel like the end of all spontaneous joy.", "It would feel like having a magic eight-ball that actually worked.", "We would finally know if 'the one with the guy from that other thing' is a good movie."],
    correctAnswer: 2
  }
};
let currentKnownUnknownsQuestion = 0;

const unknownKnownsQuizzes = [
  {
    question: "Eliot Ness is looking for his team. He turns to you and asks: 'What are you prepared to do?' What is your answer?",
    answers: [
      "I'm prepared to order the largest popcorn bucket and share none of it.",
      "I'm prepared to handle the ticket queue, but only if you hold my place in the concession line.",
      "I'm prepared to be the one who makes a promise... and then, when I'm in over my head, I'm prepared to be the one to go to a meeting, and then, at that meeting, make a different promise.",
      "I'm prepared to make a new plan. I'm prepared to follow it.",
    ],
    correctAnswer: 3,
    zinger: "'There is no crying in baseball!' Just kidding. The real quote is: 'What are you prepared to do?!'",
  },
  {
    question: "You've just found a crucial piece of information, but it means deviating from the plan. What's your immediate move?",
    answers: [
      "'I'm the chief, I'm the chief! No, I'm the chief!'",
      "'Leave the gun. Take the cannoli.'",
      "I go back and get them, every last one.",
      "'Let's re-evaluate. The numbers are speaking to me.'",
    ],
    correctAnswer: 2,
    zinger: "'Leave the gun. Take the cannoli.' is a great line, but the correct answer is 'I go back and get them, every last one.'",
  },
  {
    question: "A trusted team member makes a small mistake that causes a minor setback. What is your response?",
    answers: [
      "'You're an errand boy, sent by grocery clerks, to collect a bill!'",
      "'You're a disgrace to the entire team! Don't you know who I am?'",
      "'We‚Äôre a team. There‚Äôs no me in team. It‚Äôs a team-a-go-go!'",
      "'A team, that‚Äôs all we are. We're a team, and we'll get through this together.'",
    ],
    correctAnswer: 3,
    zinger: "'You're an errand boy...' is fun, but the right answer is a more classic display of team-based loyalty!",
  },
];
let currentUnknownKnownsQuestion = 0;

const blackSwanEvents = [
  {
    event: "A scheduling vortex opens, double-booking us for two different movie premieres at the same time.",
    solution: "Instead of choosing, we decide to split up, live-stream to each other, and create the world‚Äôs first collaborative two-perspective movie review.",
    weirder: "The scheduling vortex collapses, revealing a parallel dimension where all movies are silent films, and our only form of communication is interpretive dance."
  },
  {
    event: "During a crucial moment of 'Heads-Down Focus Time,' a movie theatre alarm blares for no reason.",
    solution: "We calmly evacuate, find a nearby cafe, and turn the unexpected break into a 'Wellness Time' session, reflecting on the experience over coffee.",
    weirder: "The alarm was a signal. We're now being recruited by a secret agency to join a team of highly-trained movie-goers who defuse cinematic crises."
  },
  {
    event: "One of our team members is feeling overwhelmed by a last-minute change of plans.",
    solution: "We pause the quest. The movie can wait. We spend the evening just hanging out and talking, prioritizing our team's shared mental health.",
    weirder: "Our emotional bond becomes so strong that we start to communicate telepathically, eliminating the need for showtimes altogether."
  },
  {
    event: "The theater's new 'smart pricing' system charges a different amount for everyone based on their unique cinematic fingerprint.",
    solution: "We pool our funds, agree to a single price, and challenge the system's lack of transparency, proving that our collective value is greater than its algorithm.",
    weirder: "The system, recognizing our superior collaboration, offers us a lifetime supply of popcorn and becomes our personal AI movie concierge."
  }
];

function updateQuadrantStatus(className, isComplete, progressText) {
  const quadrant = document.querySelector(`.${className}`);
  const progress = document.getElementById(`${className}-progress`);
  if (!quadrant || !progress) return;

  if (isComplete) {
    quadrant.classList.add('quadrant-completed');
    progress.textContent = progressText;
  } else {
    quadrant.classList.remove('quadrant-completed');
    progress.textContent = progressText;
  }
}

function updateSectionProgress() {
  const movieCount = Object.keys(movieData).length;
  updateQuadrantStatus('known-knowns', movieCount >= totalMovies, `${movieCount}/${totalMovies} movies watched`);
  updateQuadrantStatus('known-unknowns', sectionProgress.knownUnknowns, `All questions answered!`);
  updateQuadrantStatus('unknown-knowns', sectionProgress.unknownKnowns, `Loyalty proven!`);
  updateQuadrantStatus('unknown-unknowns', sectionProgress.unknownUnknowns, `Ready for anything!`);
  saveData();
}

window.startKnownUnknownsQuiz = function() {
  const container = document.getElementById('known-unknowns-quiz-container');
  container.innerHTML = `
    <div class="glass-card p-4 rounded-xl space-y-4" role="region" aria-live="polite">
      <h4 class="text-lg font-bold text-white">The Planning & Research Quiz</h4>
      <div class="quiz-question text-slate-300"></div>
      <div class="quiz-options flex flex-col space-y-2" role="group"></div>
      <p class="quiz-feedback text-sm mt-2 font-semibold" aria-live="assertive"></p>
    </div>
  `;
  currentKnownUnknownsQuestion = 0;
  loadKnownUnknownsQuestion();
}

function loadKnownUnknownsQuestion() {
  const container = document.getElementById('known-unknowns-quiz-container');
  const quizData = Object.values(knownUnknownsQuizzes)[currentKnownUnknownsQuestion];
  const quizQuestion = container.querySelector('.quiz-question');
  const quizOptions = container.querySelector('.quiz-options');
  const quizFeedback = container.querySelector('.quiz-feedback');

  quizFeedback.textContent = '';
  quizQuestion.textContent = quizData.question;
  quizOptions.innerHTML = '';
 
  quizData.answers.forEach((answer, index) => {
    const button = document.createElement('button');
    button.textContent = answer;
    button.className = 'w-full p-2 text-left rounded-md bg-slate-700 hover:bg-slate-600 transition-colors';
    button.onclick = () => window.checkKnownUnknownsAnswer(index);
    quizOptions.appendChild(button);
  });
}

window.checkKnownUnknownsAnswer = function(selectedIndex) {
  const container = document.getElementById('known-unknowns-quiz-container');
  const quizData = Object.values(knownUnknownsQuizzes)[currentKnownUnknownsQuestion];
  const quizFeedback = container.querySelector('.quiz-feedback');
  const options = container.querySelectorAll('.quiz-options button');
  options.forEach(btn => btn.disabled = true);

  if (selectedIndex === quizData.correctAnswer) {
    quizFeedback.textContent = 'Insight Gained!';
    quizFeedback.classList.remove('text-red-400');
    quizFeedback.classList.add('text-green-400');
   
    currentKnownUnknownsQuestion++;
    setTimeout(() => {
      if (currentKnownUnknownsQuestion < Object.keys(knownUnknownsQuizzes).length) {
        loadKnownUnknownsQuestion();
      } else {
        container.innerHTML = `<p class="text-lg font-bold text-green-400">All unknowns have been converted! You are ready for the next phase of your quest.</p><button class="btn-primary mt-4" onclick="window.showScreen('main-screen')">Return to Main Quest</button>`;
        sectionProgress.knownUnknowns = true;
        updateSectionProgress();
      }
    }, 1500);
   
  } else {
    quizFeedback.textContent = 'Oops! That\'s not it. Give it another try!';
    quizFeedback.classList.remove('text-green-400');
    quizFeedback.classList.add('text-red-400');
    setTimeout(() => options.forEach(btn => btn.disabled = false), 1000);
  }
}

window.startRelationalQuiz = function() {
  const container = document.getElementById('relational-quiz-container');
  const quizButton = document.getElementById('relational-quiz-button');

  quizButton.classList.add('hidden');
  container.classList.remove('hidden');

  currentUnknownKnownsQuestion = 0;
  loadRelationalQuestion();
}

function loadRelationalQuestion() {
  const container = document.getElementById('relational-quiz-container');
  const quizData = unknownKnownsQuizzes[currentUnknownKnownsQuestion];
  const quizQuestion = container.querySelector('.quiz-question');
  const quizOptions = container.querySelector('.quiz-options');
  const quizFeedback = container.querySelector('.quiz-feedback');

  quizFeedback.textContent = '';
  quizQuestion.textContent = quizData.question;
  quizOptions.innerHTML = '';

  quizData.answers.forEach((answer, index) => {
    const button = document.createElement('button');
    button.textContent = answer;
    button.className = 'w-full p-2 text-left rounded-md bg-slate-700 hover:bg-slate-600 transition-colors';
    button.onclick = () => window.checkRelationalAnswer(index);
    quizOptions.appendChild(button);
  });
}

window.checkRelationalAnswer = function(selectedIndex) {
  const container = document.getElementById('relational-quiz-container');
  const quizOptions = container.querySelector('.quiz-options');
  const quizFeedback = container.querySelector('.quiz-feedback');
  quizOptions.querySelectorAll('button').forEach(btn => btn.disabled = true);

  const quizData = unknownKnownsQuizzes[currentUnknownKnownsQuestion];
 
  if (selectedIndex === quizData.correctAnswer) {
    quizFeedback.textContent = `Insight Gained! ${quizData.zinger}`;
    quizFeedback.classList.remove('text-red-400');
    quizFeedback.classList.add('text-green-400');

    currentUnknownKnownsQuestion++;
    setTimeout(() => {
      if (currentUnknownKnownsQuestion < unknownKnownsQuizzes.length) {
        loadRelationalQuestion();
      } else {
        container.innerHTML = `<p class="text-lg font-bold text-green-400">Your loyalty is proven! All team lessons learned.</p><button class="btn-primary mt-4" onclick="window.showScreen('main-screen')">Return to Main Quest</button>`;
        sectionProgress.unknownKnowns = true;
        updateSectionProgress();
      }
    }, 2000);
  } else {
    quizFeedback.textContent = 'Oops! That\'s not it. Trust is earned. Give it another try!';
    quizFeedback.classList.remove('text-green-400');
    quizFeedback.classList.add('text-red-400');
    setTimeout(() => quizOptions.querySelectorAll('button').forEach(btn => btn.disabled = false), 1000);
  }
}

function updateProgress() {
  const count = Object.keys(movieData).length;
  if(moviesWatchedSpan) {
    moviesWatchedSpan.textContent = count;
  }
  if(progressFill) {
    progressFill.style.width = (count / totalMovies * 100) + '%';
  }
  if(movieCards.length > 0) {
    movieCards.forEach(card => {
      const movie = card.dataset.movie;
      const startButton = card.querySelector('.btn-primary');
      const watchedButton = card.querySelector('.mark-watched-btn');
      const quizContainer = card.querySelector('.quiz-container');

      if(movieData[movie]) {
        if(startButton) startButton.style.display = 'none';
        if(quizContainer) quizContainer.style.display = 'none';
        if(watchedButton) {
          watchedButton.textContent = "‚úì Watched";
          watchedButton.disabled = true;
          watchedButton.classList.remove('hidden');
        }
      } else {
        if(startButton) {
          startButton.style.display = 'block';
          startButton.textContent = 'Start Trivia!';
        }
        if(quizContainer) quizContainer.style.display = 'none';
        if(watchedButton) {
          watchedButton.classList.add('hidden');
          watchedButton.disabled = false;
        }
      }
    });
  }
  if(rewardsStatus) {
    if(count>=3){ rewardsStatus.innerHTML='<span class="rewards-badge rewards-earned">üéâ $50 Gift Card Earned! üéâ</span>'; }
    else if(count>=2){ rewardsStatus.innerHTML='<span class="rewards-badge rewards-earned">üëè $15 Gift Card Earned! üëè</span>'; }
    else { rewardsStatus.innerHTML=''; }
  }
  updateSectionProgress();
}

window.showQuiz = function(button, event) {
  event.stopPropagation();
  if (button.dataset.processing) return;
  button.dataset.processing = "true";

  const card = button.closest('.movie-card');
  const quizContainer = card.querySelector('.quiz-container');
 
  if (quizContainer) {
    const movie = card.dataset.movie;
    const quizData = movieQuizzes[movie];
    if (quizData) {
      startQuiz(card, quizData);
      button.style.display = 'none';
      quizContainer.style.display = 'block';
      setTimeout(() => delete button.dataset.processing, 500);
    }
  }
}

function startQuiz(card, quizData) {
  const quizQuestion = card.querySelector('.quiz-question');
  const quizOptions = card.querySelector('.quiz-options');
  const quizFeedback = card.querySelector('.quiz-feedback');
  const watchedBtn = card.querySelector('.mark-watched-btn');
 
  quizFeedback.textContent = '';
  watchedBtn.classList.add('hidden');

  quizQuestion.textContent = quizData.question;
  quizOptions.innerHTML = ''; // Clear previous options
 
  quizData.answers.forEach((answer, index) => {
    const button = document.createElement('button');
    button.textContent = answer;
    button.className = 'w-full p-2 text-left rounded-md bg-slate-700 hover:bg-slate-600 transition-colors';
    button.onclick = () => window.checkAnswer(card, quizData, index);
    quizOptions.appendChild(button);
  });
}

window.checkAnswer = function(card, quizData, selectedIndex) {
  const quizFeedback = card.querySelector('.quiz-feedback');
  const watchedBtn = card.querySelector('.mark-watched-btn');
  const options = card.querySelectorAll('.quiz-options button');
  options.forEach(button => button.disabled = true);
 
  if (selectedIndex === quizData.correctAnswer) {
    quizFeedback.textContent = 'Correct! That\'s the one!';
    quizFeedback.classList.remove('text-red-400');
    quizFeedback.classList.add('text-green-400');
    watchedBtn.classList.remove('hidden');
    watchedBtn.focus();
  } else {
    quizFeedback.textContent = 'Oops! That\'s not it. Give it another try!';
    quizFeedback.classList.remove('text-green-400');
    quizFeedback.classList.add('text-red-400');
    setTimeout(() => options.forEach(button => button.disabled = false), 1000);
  }
}

window.markAsWatched = function(button, event) {
  event.stopPropagation();
  const card = button.closest('.movie-card');
  const movie = card.dataset.movie;
  if(!movieData[movie]){
    movieData[movie] = true;
    saveData();
    updateProgress();
  }
}

window.showScreen = function(screenId) {
  document.querySelectorAll('.screen').forEach(screen => {
    screen.style.display = 'none';
  });
  const screenToShow = document.getElementById(screenId);
  if (screenToShow) {
    screenToShow.style.display = 'block';
    if(screenId === 'known-knowns-screen') {
      updateProgress();
    }
  }
}

window.startCrisisSimulation = function() {
  const startButton = document.getElementById('start-crisis-button');
  const crisisContainer = document.getElementById('crisis-container');
  const crisisEvent = document.getElementById('crisis-event');
  const crisisSolution = document.getElementById('crisis-solution-text');
 
  const randomIndex = Math.floor(Math.random() * blackSwanEvents.length);
  const selectedCrisis = blackSwanEvents[randomIndex];
 
  crisisEvent.textContent = `CRISIS: ${selectedCrisis.event}`;
  crisisSolution.textContent = selectedCrisis.solution;

  startButton.style.display = 'none';
  crisisContainer.classList.remove('hidden');
 
  const weirderButton = document.createElement('button');
  weirderButton.className = 'back-btn mt-4';
  weirderButton.textContent = 'What if it gets weirder?';
  weirderButton.onclick = () => {
    crisisEvent.textContent = 'UNIMAGINABLE REALITY:';
    crisisSolution.textContent = selectedCrisis.weirder;
    weirderButton.remove();
  };
  crisisContainer.appendChild(weirderButton);

  const resetButton = document.createElement('button');
  resetButton.className = 'back-btn mt-4 ml-2';
  resetButton.textContent = 'Reset Simulation';
  resetButton.onclick = () => {
    crisisContainer.classList.add('hidden');
    startButton.style.display = 'block';
    weirderButton.remove();
    resetButton.remove();
  };
  crisisContainer.appendChild(resetButton);
}

// Starfield
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
let stars=[];
function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; stars=[]; for(let i=0;i<200;i++){ stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.2+0.2, dx:(Math.random()-0.5)*0.1, dy:(Math.random()-0.5)*0.1}); } }
function animate(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,2*Math.PI); ctx.fillStyle="white"; ctx.globalAlpha=Math.random()*0.5+0.5; ctx.fill(); s.x+=s.dx; s.y+=s.dy; if(s.x<0)s.x=canvas.width;if(s.x>canvas.width)s.x=0;if(s.y<0)s.y=canvas.height;if(s.y>canvas.height)s.y=0; } requestAnimationFrame(animate); }
window.addEventListener('resize',resize); resize(); animate();

window.onload=function(){
  loadData();
 
  const audioElement = document.getElementById('movie-theme-song');
  if (audioElement) {
    audioElement.src = audioUrl;
    audioElement.onerror = function() {
      console.warn('Audio file could not be loaded');
      this.style.display = 'none';
    };
  }
 
  window.showScreen('main-screen');
  updateProgress();
 
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      window.showScreen('main-screen');
    }
  });
}
</script>
</body>
</html>